

## Update Cluster Manager for Everence Wealth (EN + ES Only, Content-Aware Images)

### Problems Found

1. **`types.ts` still has 10 languages** -- `DEFAULT_TRANSLATION_LANGUAGES` lists 9 European languages, `LANGUAGE_FLAGS` has all 10, and helper functions expect 10 languages
2. **`ClusterArticlesTab.tsx` expects 60 articles** (6 articles x 10 languages) -- should be 12 (6 x 2)
3. **Legacy URL** -- "View Live" link points to `delsolprimehomes.com`
4. **Image generation is generic** -- The `regenerate-cluster-images` edge function uses pre-written "scene variations" (e.g., "advisor meeting with retired couple") that have nothing to do with the actual article content. Images should be generated by reading the article's copy and creating something hyper-specific to it
5. **Legacy `LANGUAGE_NAMES`** in the edge function lists 10 languages
6. **Uses OpenAI directly** for metadata -- should use Lovable AI gateway instead

---

### Changes

#### 1. Fix `src/components/admin/cluster-manager/types.ts`

- Change `DEFAULT_TRANSLATION_LANGUAGES` from `["de", "nl", "fr", "pl", "sv", "da", "hu", "fi", "no"]` to `["es"]`
- Reduce `LANGUAGE_FLAGS` to only `en` and `es`
- Update `en` flag from British flag to US flag

#### 2. Fix `src/components/admin/cluster-manager/ClusterArticlesTab.tsx`

- Change `totalExpected` from `60` to `12` (6 articles x 2 languages)
- Update the "View Live" URL from `delsolprimehomes.com` to `everencewealth.com`
- Translation button text already dynamically shows the count -- it will automatically show "1 incomplete" instead of "9 incomplete" once the types are fixed

#### 3. Rewrite `supabase/functions/regenerate-cluster-images/index.ts`

This is the biggest change. Instead of generic scene prompts, the function will:

- **Read each article's `detailed_content`** (the actual copy)
- **Extract a content summary** using Lovable AI (Gemini Flash) to create a hyper-specific image prompt based on what the article is actually about
- **Generate the image** using Fal.ai Nano Banana Pro with that content-specific prompt
- **Use Lovable AI** instead of OpenAI for generating localized alt text and captions
- **Remove `SCENE_VARIATIONS`** array entirely -- no more generic scenes
- **Fix `LANGUAGE_NAMES`** to only include `en` and `es`
- **Remove `OPENAI_API_KEY` dependency** -- replaced with `LOVABLE_API_KEY`

The new flow per article:
```text
Article Content --> Lovable AI extracts key visual themes --> 
Specific image prompt (e.g., "Professional chart showing tax-free 
retirement buckets with IUL policy growth curves") -->
Fal.ai Nano Banana Pro generates image --> Upload to storage
```

#### 4. Deploy updated edge function

The `regenerate-cluster-images` function will be redeployed automatically.

---

### What This Means for You

- The cluster manager buttons will correctly show EN + ES status only (not 10 languages)
- "Complete Translations" will show 1 incomplete max (Spanish) instead of 9
- Article count targets will be 12 instead of 60
- When you click "Bulk Regenerate Images" or "Smart Image Regeneration", every image will be created based on what that specific article is actually about -- not a generic stock-photo-style scene
- All links will point to `everencewealth.com`

